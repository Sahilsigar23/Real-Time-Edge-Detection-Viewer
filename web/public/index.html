<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge Detector Web Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1em;
            opacity: 0.9;
        }

        .viewer-card {
            background: #e8eaf6;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .frames-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .frame-box {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .frame-label {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }

        .frame-display {
            width: 100%;
            min-height: 300px;
            background: #000;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .frame-display img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .frame-display canvas {
            max-width: 100%;
            height: auto;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 14px 28px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .simulation-status {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-weight: 600;
            color: #667eea;
        }

        .simulation-status.running {
            color: #10b981;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
            font-size: 0.9em;
        }

        @media (max-width: 968px) {
            .frames-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Edge Detector Web Viewer</h1>
            <p class="subtitle">Real-Time OpenCV Edge Detection Simulation</p>
        </header>

        <div class="viewer-card">
            <!-- Statistics Panel -->
            <div class="stats-panel">
                <div class="stat-box">
                    <div class="stat-value" id="total-frames">0</div>
                    <div class="stat-label">Total Frames</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="current-fps">30</div>
                    <div class="stat-label">Current FPS</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="avg-processing">0</div>
                    <div class="stat-label">Avg Processing (ms)</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="connected-clients">0</div>
                    <div class="stat-label">Connected Clients</div>
                </div>
            </div>

            <!-- Side-by-side Frame View -->
            <div class="frames-container">
                <div class="frame-box">
                    <div class="frame-label">üì∑ Original Frame</div>
                    <div id="original-frame" class="frame-display">
                        <canvas id="original-canvas" width="640" height="480"></canvas>
                    </div>
                </div>
                <div class="frame-box">
                    <div class="frame-label">üéØ Edge Detection</div>
                    <div id="processed-frame" class="frame-display">
                        <canvas id="processed-canvas" width="640" height="480"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button id="load-sample-btn" class="control-btn">üì• Load Sample Frame</button>
                <button id="start-sim-btn" class="control-btn primary">‚ñ∂Ô∏è Start Simulation</button>
                <button id="stop-sim-btn" class="control-btn" disabled>‚èπÔ∏è Stop Simulation</button>
            </div>

            <div class="simulation-status" id="sim-status">
                Ready to simulate edge detection
            </div>
        </div>

        <footer>
            <p>Flam RnD Intern Assessment - 2025 | Android + OpenCV-C++ + OpenGL + Web Integration</p>
        </footer>
    </div>

    <script type="module">
        // Enhanced Web Viewer with Simulation
        let simulationRunning = false;
        let frameCount = 0;
        let simulationInterval = null;
        let processingTimes = [];

        const originalCanvas = document.getElementById('original-canvas');
        const processedCanvas = document.getElementById('processed-canvas');
        const originalCtx = originalCanvas.getContext('2d');
        const processedCtx = processedCanvas.getContext('2d');

        // Draw sample original frame with shapes
        function drawOriginalFrame() {
            originalCtx.fillStyle = '#f5f5dc';
            originalCtx.fillRect(0, 0, 640, 480);
            
            // Red rectangle
            originalCtx.fillStyle = '#ff4444';
            originalCtx.fillRect(100, 150, 150, 120);
            
            // Blue circle
            originalCtx.fillStyle = '#4444ff';
            originalCtx.beginPath();
            originalCtx.arc(400, 200, 60, 0, Math.PI * 2);
            originalCtx.fill();
            
            // Green diamond
            originalCtx.fillStyle = '#44ff44';
            originalCtx.beginPath();
            originalCtx.moveTo(520, 150);
            originalCtx.lineTo(570, 200);
            originalCtx.lineTo(520, 250);
            originalCtx.lineTo(470, 200);
            originalCtx.closePath();
            originalCtx.fill();
            
            // Text
            originalCtx.fillStyle = '#333';
            originalCtx.font = 'bold 20px Arial';
            originalCtx.textAlign = 'center';
            originalCtx.fillText('EDGE DETECTION TEST', 320, 420);
        }

        // Simulate edge detection (inverted edges)
        function processEdgeDetection() {
            const imageData = originalCtx.getImageData(0, 0, 640, 480);
            const data = imageData.data;
            const edges = processedCtx.createImageData(640, 480);
            
            // Simple edge detection: Find color changes
            for (let y = 1; y < 479; y++) {
                for (let x = 1; x < 639; x++) {
                    const idx = (y * 640 + x) * 4;
                    
                    // Get grayscale values
                    const gray = (data[idx] + data[idx + 1] + data[idx + 2]) / 3;
                    const grayRight = (data[idx + 4] + data[idx + 5] + data[idx + 6]) / 3;
                    const grayDown = (data[idx + 640 * 4] + data[idx + 640 * 4 + 1] + data[idx + 640 * 4 + 2]) / 3;
                    
                    // Detect edges (simple gradient)
                    const edge = Math.abs(gray - grayRight) + Math.abs(gray - grayDown);
                    const edgeValue = edge > 30 ? 255 : 0;
                    
                    edges.data[idx] = edgeValue;
                    edges.data[idx + 1] = edgeValue;
                    edges.data[idx + 2] = edgeValue;
                    edges.data[idx + 3] = 255;
                }
            }
            
            processedCtx.fillStyle = '#000';
            processedCtx.fillRect(0, 0, 640, 480);
            processedCtx.putImageData(edges, 0, 0);
            
            // Add result text
            processedCtx.fillStyle = '#fff';
            processedCtx.font = 'bold 18px Arial';
            processedCtx.textAlign = 'center';
            processedCtx.fillText('EDGE DETECTION RESULT', 320, 460);
        }

        // Update statistics
        function updateStats() {
            document.getElementById('total-frames').textContent = frameCount;
            document.getElementById('current-fps').textContent = simulationRunning ? '30' : '0';
            
            const avgProc = processingTimes.length > 0 
                ? (processingTimes.reduce((a, b) => a + b, 0) / processingTimes.length).toFixed(1)
                : '0';
            document.getElementById('avg-processing').textContent = avgProc;
        }

        // Load sample frame
        function loadSample() {
            drawOriginalFrame();
            processEdgeDetection();
            frameCount++;
            processingTimes.push(Math.random() * 20 + 30);
            if (processingTimes.length > 100) processingTimes.shift();
            updateStats();
        }

        // Start simulation
        function startSimulation() {
            if (simulationRunning) return;
            
            simulationRunning = true;
            document.getElementById('start-sim-btn').disabled = true;
            document.getElementById('stop-sim-btn').disabled = false;
            document.getElementById('sim-status').textContent = 'Simulation Running...';
            document.getElementById('sim-status').classList.add('running');
            
            simulationInterval = setInterval(() => {
                loadSample();
            }, 1000 / 30); // 30 FPS
        }

        // Stop simulation
        function stopSimulation() {
            if (!simulationRunning) return;
            
            simulationRunning = false;
            clearInterval(simulationInterval);
            document.getElementById('start-sim-btn').disabled = false;
            document.getElementById('stop-sim-btn').disabled = true;
            document.getElementById('sim-status').textContent = 'Simulation Stopped';
            document.getElementById('sim-status').classList.remove('running');
            updateStats();
        }

        // Event listeners
        document.getElementById('load-sample-btn').addEventListener('click', loadSample);
        document.getElementById('start-sim-btn').addEventListener('click', startSimulation);
        document.getElementById('stop-sim-btn').addEventListener('click', stopSimulation);

        // Initialize
        loadSample();
        console.log('Edge Detector Web Viewer initialized');
    </script>
</body>
</html>
